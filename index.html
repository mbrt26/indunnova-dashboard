<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indunnova - Dashboard de Aplicaciones</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">üöÄ</span>
                <h1>Indunnova Dashboard</h1>
            </div>
            <div class="header-info">
                <span class="last-update" id="lastUpdate">Ultima actualizacion: --</span>
                <button class="refresh-btn" onclick="loadData()">
                    <span class="refresh-icon">‚Üª</span> Actualizar
                </button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Resumen Principal -->
        <section class="summary-section">
            <div class="summary-card total-services">
                <div class="summary-icon">‚òÅÔ∏è</div>
                <div class="summary-info">
                    <span class="summary-value" id="totalServices">--</span>
                    <span class="summary-label">Servicios Cloud Run</span>
                </div>
            </div>
            <div class="summary-card healthy-services">
                <div class="summary-icon">‚úÖ</div>
                <div class="summary-info">
                    <span class="summary-value" id="healthyServices">--</span>
                    <span class="summary-label">Servicios Activos</span>
                </div>
            </div>
            <div class="summary-card unhealthy-services">
                <div class="summary-icon">‚ö†Ô∏è</div>
                <div class="summary-info">
                    <span class="summary-value" id="unhealthyServices">--</span>
                    <span class="summary-label">Con Problemas</span>
                </div>
            </div>
            <div class="summary-card total-repos">
                <div class="summary-icon">üì¶</div>
                <div class="summary-info">
                    <span class="summary-value" id="totalRepos">--</span>
                    <span class="summary-label">Repositorios</span>
                </div>
            </div>
        </section>

        <!-- Costos del Proyecto -->
        <section class="costs-section">
            <h2>Costos Mensuales Estimados</h2>
            <div class="costs-grid">
                <div class="cost-card total-cost">
                    <div class="cost-icon">üí∞</div>
                    <div class="cost-info">
                        <span class="cost-value" id="totalCost">--</span>
                        <span class="cost-label">Total Estimado/Mes</span>
                    </div>
                </div>
                <div class="cost-card sql-cost">
                    <div class="cost-icon">üóÑÔ∏è</div>
                    <div class="cost-info">
                        <span class="cost-value" id="sqlCost">--</span>
                        <span class="cost-label">Cloud SQL</span>
                        <span class="cost-detail" id="sqlInstances">-- activas</span>
                    </div>
                </div>
                <div class="cost-card run-cost">
                    <div class="cost-icon">‚òÅÔ∏è</div>
                    <div class="cost-info">
                        <span class="cost-value" id="runCost">--</span>
                        <span class="cost-label">Cloud Run</span>
                    </div>
                </div>
                <div class="cost-card other-cost" id="otherCostCard" title="Desglose de otros servicios GCP">
                    <div class="cost-icon">üìä</div>
                    <div class="cost-info">
                        <span class="cost-value" id="otherCost">--</span>
                        <span class="cost-label">Otros Servicios</span>
                        <span class="cost-detail" id="otherBreakdown">--</span>
                    </div>
                </div>
            </div>
            <div class="cost-source" id="costSource" style="text-align: right; font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;"></div>
        </section>

        <!-- Metricas de Desempeno -->
        <section class="metrics-section">
            <h2>Metricas de Desempeno (Ultimos 7 dias)</h2>
            <div class="metrics-grid">
                <a href="errors.html" class="metric-card errors clickable">
                    <div class="metric-header">
                        <span class="metric-icon">üî¥</span>
                        <span class="metric-title">Errores</span>
                    </div>
                    <div class="metric-body">
                        <div class="metric-main">
                            <span class="metric-value" id="totalErrors7d">--</span>
                            <span class="metric-period">7 dias</span>
                        </div>
                        <div class="metric-secondary">
                            <span id="totalErrors24h">--</span> ultimas 24h
                        </div>
                    </div>
                    <div class="metric-action">Ver todos los errores ‚Üí</div>
                </a>
                <div class="metric-card deployments">
                    <div class="metric-header">
                        <span class="metric-icon">üöÄ</span>
                        <span class="metric-title">Despliegues</span>
                    </div>
                    <div class="metric-body">
                        <div class="metric-main">
                            <span class="metric-value" id="totalDeployments7d">--</span>
                            <span class="metric-period">7 dias</span>
                        </div>
                        <div class="metric-secondary">
                            <span id="totalDeployments24h">--</span> ultimas 24h
                        </div>
                    </div>
                </div>
                <a href="issues.html" class="metric-card services-errors clickable">
                    <div class="metric-header">
                        <span class="metric-icon">üé´</span>
                        <span class="metric-title">Issues Automaticos</span>
                    </div>
                    <div class="metric-body">
                        <div class="metric-main">
                            <span class="metric-value" id="servicesWithErrors">--</span>
                            <span class="metric-period">servicios</span>
                        </div>
                        <div class="metric-secondary">
                            con errores consolidados
                        </div>
                    </div>
                    <div class="metric-action">Ver issues y analisis ‚Üí</div>
                </a>
            </div>
        </section>

        <!-- Grafico de Errores Diarios -->
        <section class="chart-section">
            <h2>Errores por Dia (Ultimos 7 dias)</h2>
            <div class="daily-chart-container">
                <div class="daily-chart" id="dailyErrorsChart">
                    <div class="loading">Cargando grafico...</div>
                </div>
            </div>
        </section>

        <!-- Mapa de Calor de Uso -->
        <section class="heatmap-section">
            <h2>Mapa de Calor - Uso de Aplicativos</h2>
            <div class="heatmap-container">
                <div class="heatmap-legend">
                    <span class="legend-label">Menos uso</span>
                    <div class="legend-gradient"></div>
                    <span class="legend-label">Mas uso</span>
                </div>
                <div class="heatmap-grid" id="usageHeatmap">
                    <div class="loading">Cargando mapa de calor...</div>
                </div>
            </div>
        </section>

        <!-- Despliegues Recientes -->
        <section class="recent-deployments-section">
            <h2>Despliegues Recientes por Aplicativo</h2>
            <div class="recent-deployments-grid" id="recentDeploymentsGrid">
                <div class="loading">Cargando despliegues...</div>
            </div>
        </section>

        <!-- Filtros -->
        <section class="filters-section">
            <div class="filter-group">
                <label>Estado:</label>
                <select id="statusFilter" onchange="filterServices()">
                    <option value="all">Todos</option>
                    <option value="healthy">Activos</option>
                    <option value="unhealthy">Con Problemas</option>
                    <option value="errors">Con Errores</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Ordenar por:</label>
                <select id="sortFilter" onchange="filterServices()">
                    <option value="name">Nombre</option>
                    <option value="errors">Mas Errores</option>
                    <option value="deployments">Mas Despliegues</option>
                    <option value="recent">Despliegue Reciente</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Buscar:</label>
                <input type="text" id="searchFilter" placeholder="Nombre del servicio..." oninput="filterServices()">
            </div>
        </section>

        <!-- Servicios Cloud Run -->
        <section class="services-section">
            <h2>Servicios Cloud Run</h2>
            <div class="services-grid" id="servicesGrid">
                <div class="loading">Cargando servicios...</div>
            </div>
        </section>

        <!-- Modal de Detalles -->
        <div class="modal" id="serviceModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Detalles del Servicio</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body" id="modalBody">
                </div>
            </div>
        </div>

        <!-- Repositorios -->
        <section class="repos-section">
            <h2>Repositorios GitHub</h2>
            <div class="repos-grid" id="reposGrid">
                <div class="loading">Cargando repositorios...</div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>Indunnova - Dashboard de Monitoreo</p>
        <p>Proyecto: appsindunnova | Region: us-central1</p>
    </footer>

    <script src="js/app.js"></script>
</body>
</html>
